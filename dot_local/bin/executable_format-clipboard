#!/usr/bin/env bash
language=$(pbpaste | guesslang --probabilities | grep -Eo -m 1 'Python|Ruby|SQL')

echo "$language"

case $language in
Ruby) ;&
Python)
	command="ruff check --fix --select I - | ruff format -"
	;;
SQL)
	command="sql-formatter --config ~/.config/sql-formatter/sql-formatter.json"
	;;
esac

{
	pbpaste | grep '^%'
	pbpaste | grep --invert-match '^%' | eval "$command" | ghead --bytes -1
} | tee /dev/tty | pbcopy
