#!/usr/bin/env bash
export AWS_PROFILE="$1"

credentials_text=$(aws sts get-session-token \
	--duration-seconds 129600 \
	--output text \
	--profile "${AWS_PROFILE}-long-term" \
	--query "Credentials.[AccessKeyId,SecretAccessKey,SessionToken,Expiration]" \
	--serial-number "$(aws configure get mfa_serial)" \
  --token-code "$(eval "$(aws configure get mfa_process)")")

printf '{"Version":1,"AccessKeyId":"%s","SecretAccessKey":"%s","SessionToken":"%s","Expiration":"%s"}' ${credentials_text} | tee /dev/tty
