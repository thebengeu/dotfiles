#!/usr/bin/env bash
export AWS_PROFILE="$1"

printf '{"Version":1,"AccessKeyId":"%s","SecretAccessKey":"%s","SessionToken":"%s","Expiration":"%s"}' \
	$(aws sts get-session-token \
		--serial-number "$(aws configure get mfa_serial)" \
		--token-code "$(eval "$(aws configure get mfa_process)")" \
		--duration-seconds 129600 \
		--output text \
		--query "Credentials.[AccessKeyId,SecretAccessKey,SessionToken,Expiration]" \
		--profile "${AWS_PROFILE}-long-term")
